<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha256-xejo6yLi6vGtAjcMIsY8BHdKsLg7QynVlFMzdQgUuy8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.logres.tech","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.12.3","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="本来有个不错的机会可以跟着某大厂的训练营进行学习，但或许是名额有限，又或者是本人太菜，错失良机。不过，既然没法跟着学，那就自己动手，丰衣足食，自学成才吧！这gRPC正是其中的一环……">
<meta property="og:type" content="article">
<meta property="og:title" content="初识gRPC">
<meta property="og:url" content="https://blog.logres.tech/%E5%88%9D%E8%AF%86gRPC/%E5%88%9D%E8%AF%86grpc/index.html">
<meta property="og:site_name" content="Logres&#39; Blog">
<meta property="og:description" content="本来有个不错的机会可以跟着某大厂的训练营进行学习，但或许是名额有限，又或者是本人太菜，错失良机。不过，既然没法跟着学，那就自己动手，丰衣足食，自学成才吧！这gRPC正是其中的一环……">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-06-22T13:00:27.000Z">
<meta property="article:modified_time" content="2022-06-22T13:00:27.000Z">
<meta property="article:author" content="Logres">
<meta property="article:tag" content="Logres">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.logres.tech/%E5%88%9D%E8%AF%86gRPC/%E5%88%9D%E8%AF%86grpc/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.logres.tech/%E5%88%9D%E8%AF%86gRPC/%E5%88%9D%E8%AF%86grpc/","path":"初识gRPC/初识grpc/","title":"初识gRPC"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>初识gRPC | Logres' Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Logres' Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">君子不器</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-number">2.</span> <span class="nav-text">工作流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99proto%E6%96%87%E4%BB%B6"><span class="nav-number">2.1.</span> <span class="nav-text">编写proto文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E7%94%9F%E6%88%90pb2-%E4%B8%8E-pb2-grpc%E4%BB%A3%E7%A0%81"><span class="nav-number">2.2.</span> <span class="nav-text">编译生成pb2 与 pb2_grpc代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="nav-number">3.</span> <span class="nav-text">编写客户端与服务端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="nav-number">3.1.</span> <span class="nav-text">服务端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">3.2.</span> <span class="nav-text">客户端</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E8%A1%A5%E5%85%85"><span class="nav-number">4.</span> <span class="nav-text">一些补充</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#What%E2%80%99s-Channel"><span class="nav-number">4.1.</span> <span class="nav-text">What’s Channel</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Logres</p>
  <div class="site-description" itemprop="description">凡有所学，皆成性格。</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/logres" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;logres" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:logres_king@126.com" title="E-Mail → mailto:logres_king@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.logres.tech/%E5%88%9D%E8%AF%86gRPC/%E5%88%9D%E8%AF%86grpc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Logres">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Logres' Blog">
      <meta itemprop="description" content="凡有所学，皆成性格。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="初识gRPC | Logres' Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          初识gRPC
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-22 21:00:27" itemprop="dateCreated datePublished" datetime="2022-06-22T21:00:27+08:00">2022-06-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%88%9D%E8%AF%86gRPC/" itemprop="url" rel="index"><span itemprop="name">初识gRPC</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>本来有个不错的机会可以跟着某大厂的训练营进行学习，但或许是名额有限，又或者是本人太菜，错失良机。不过，既然没法跟着学，那就自己动手，丰衣足食，自学成才吧！这gRPC正是其中的一环……</p>
<span id="more"></span>

<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>学一个新东西，需要先了解定义。</p>
<blockquote>
<p>gRPC (gRPC Remote Procedure Calls[1]) 是Google发起的一个开源远程过程调用 (Remote procedure call) 系统。该系统基于 HTTP&#x2F;2 协议传输，使用Protocol Buffers 作为接口描述语言。[2] ——wiki</p>
</blockquote>
<blockquote>
<p>gRPC is a modern open source high performance Remote Procedure Call (RPC) framework that can run in any environment. It can efficiently connect services in and across data centers with pluggable support for load balancing, tracing, health checking and authentication. It is also applicable in last mile of distributed computing to connect devices, mobile applications and browsers to backend services. ——google</p>
</blockquote>
<p>简单来说，gRPC是Google开发的一个跨语言跨平台的远程调用框架。值得一提，其基于Http2实现，支持基于流的传输，相交基于Http1.1的Rest更为高效，且支持Protocol Buffer序列化，信息熵更高。</p>
<h2 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h2><p>了解完定义、特性，已经可以向外行夸耀几句了，但是想真正投入应用，还得参考一个完整的工作流程。</p>
<p>简单而言，一个gRPC调用的应用分为以下几步：</p>
<ol>
<li>编写proto文件</li>
<li>分别生成pb2与pb2_grpc代码</li>
<li>编写client与server端</li>
</ol>
<h3 id="编写proto文件"><a href="#编写proto文件" class="headerlink" title="编写proto文件"></a>编写proto文件</h3><p>proto文件即protocol buffers的核心组成，对编码较为抽象的protocol buffers报文进行解释——通过生成代码对proto报文进行处理。</p>
<p>怎么个抽象法呢？</p>
<p>这是Json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    msg<span class="punctuation">:</span> Logres</span><br><span class="line">    code<span class="punctuation">:</span> <span class="number">11</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这是protocol buffer</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">126Logres21211</span><br></pre></td></tr></table></figure>

<p>protocol buffer报文的内容前三位分别表示字段序号、数据类型（eg. String类型编号为2）、消息长度。</p>
<p>但仅仅这三位附属数据仅能从语法上区分字段，想要从语义上进行解读还需要别的代码。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line">service WindServer &#123;</span><br><span class="line">    rpc <span class="title function_">wind_predict</span><span class="params">(Request)</span> <span class="title function_">returns</span> <span class="params">(Response)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message Request &#123;</span><br><span class="line">    <span class="built_in">string</span> content = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message Response &#123;</span><br><span class="line">    <span class="built_in">string</span> msg = <span class="number">1</span>;</span><br><span class="line">    int32 code = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述文件中的Response就对字段序号为1、2的消息进行解释，当然，此处仅给出了简单类型，复杂类型protocol也提供了相应支持，此处就暂且忽略。</p>
<h3 id="编译生成pb2-与-pb2-grpc代码"><a href="#编译生成pb2-与-pb2-grpc代码" class="headerlink" title="编译生成pb2 与 pb2_grpc代码"></a>编译生成pb2 与 pb2_grpc代码</h3><p>前面提到，protocol提供报文解析的方式是生成相应代码。</p>
<p>对于上述proto文件，我们以python为例，可以使用grpc工具生成代码。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m grpc_tools.protoc -I. --python_out=. --grpc_python_out=. wind.proto</span><br></pre></td></tr></table></figure>

<p>代码内容:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">wind_pb2.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Generated by the protocol buffer compiler.  DO NOT EDIT!</span></span><br><span class="line"><span class="comment"># source: wind.proto</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;Generated protocol buffer code.&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> google.protobuf <span class="keyword">import</span> descriptor <span class="keyword">as</span> _descriptor</span><br><span class="line"><span class="keyword">from</span> google.protobuf <span class="keyword">import</span> descriptor_pool <span class="keyword">as</span> _descriptor_pool</span><br><span class="line"><span class="keyword">from</span> google.protobuf <span class="keyword">import</span> message <span class="keyword">as</span> _message</span><br><span class="line"><span class="keyword">from</span> google.protobuf <span class="keyword">import</span> reflection <span class="keyword">as</span> _reflection</span><br><span class="line"><span class="keyword">from</span> google.protobuf <span class="keyword">import</span> symbol_database <span class="keyword">as</span> _symbol_database</span><br><span class="line"><span class="comment"># @@protoc_insertion_point(imports)</span></span><br><span class="line"></span><br><span class="line">_sym_db = _symbol_database.Default()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DESCRIPTOR = _descriptor_pool.Default().AddSerializedFile(<span class="string">b&#x27;\n\nwind.proto\&quot;\x1a\n\x07Request\x12\x0f\n\x07\x63ontent\x18\x01 \x01(\t\&quot;%\n\x08Response\x12\x0b\n\x03msg\x18\x01 \x01(\t\x12\x0c\n\x04\x63ode\x18\x02 \x01(\x05\x32\x33\n\nWindServer\x12%\n\x0cwind_predict\x12\x08.Request\x1a\t.Response\&quot;\x00\x62\x06proto3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_REQUEST = DESCRIPTOR.message_types_by_name[<span class="string">&#x27;Request&#x27;</span>]</span><br><span class="line">_RESPONSE = DESCRIPTOR.message_types_by_name[<span class="string">&#x27;Response&#x27;</span>]</span><br><span class="line">Request = _reflection.GeneratedProtocolMessageType(<span class="string">&#x27;Request&#x27;</span>, (_message.Message,), &#123;</span><br><span class="line">  <span class="string">&#x27;DESCRIPTOR&#x27;</span> : _REQUEST,</span><br><span class="line">  <span class="string">&#x27;__module__&#x27;</span> : <span class="string">&#x27;wind_pb2&#x27;</span></span><br><span class="line">  <span class="comment"># @@protoc_insertion_point(class_scope:Request)</span></span><br><span class="line">  &#125;)</span><br><span class="line">_sym_db.RegisterMessage(Request)</span><br><span class="line"></span><br><span class="line">Response = _reflection.GeneratedProtocolMessageType(<span class="string">&#x27;Response&#x27;</span>, (_message.Message,), &#123;</span><br><span class="line">  <span class="string">&#x27;DESCRIPTOR&#x27;</span> : _RESPONSE,</span><br><span class="line">  <span class="string">&#x27;__module__&#x27;</span> : <span class="string">&#x27;wind_pb2&#x27;</span></span><br><span class="line">  <span class="comment"># @@protoc_insertion_point(class_scope:Response)</span></span><br><span class="line">  &#125;)</span><br><span class="line">_sym_db.RegisterMessage(Response)</span><br><span class="line"></span><br><span class="line">_WINDSERVER = DESCRIPTOR.services_by_name[<span class="string">&#x27;WindServer&#x27;</span>]</span><br><span class="line"><span class="keyword">if</span> _descriptor._USE_C_DESCRIPTORS == <span class="literal">False</span>:</span><br><span class="line"></span><br><span class="line">  DESCRIPTOR._options = <span class="literal">None</span></span><br><span class="line">  _REQUEST._serialized_start=<span class="number">14</span></span><br><span class="line">  _REQUEST._serialized_end=<span class="number">40</span></span><br><span class="line">  _RESPONSE._serialized_start=<span class="number">42</span></span><br><span class="line">  _RESPONSE._serialized_end=<span class="number">79</span></span><br><span class="line">  _WINDSERVER._serialized_start=<span class="number">81</span></span><br><span class="line">  _WINDSERVER._serialized_end=<span class="number">132</span></span><br><span class="line"><span class="comment"># @@protoc_insertion_point(module_scope)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>尽是一些看不懂的东西，不过可以看出跟序列化的参数有关，是个类似配置模块的东西。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">wind_pb2_grpc.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generated by the gRPC Python protocol compiler plugin. DO NOT EDIT!</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;Client and server classes corresponding to protobuf-defined services.&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> wind_pb2 <span class="keyword">as</span> wind__pb2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WindServerStub</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Missing associated documentation comment in .proto file.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, channel</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Constructor.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            channel: A grpc.Channel.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.wind_predict = channel.unary_unary(</span><br><span class="line">                <span class="string">&#x27;/WindServer/wind_predict&#x27;</span>,</span><br><span class="line">                request_serializer=wind__pb2.Request.SerializeToString,</span><br><span class="line">                response_deserializer=wind__pb2.Response.FromString,</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WindServerServicer</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Missing associated documentation comment in .proto file.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wind_predict</span>(<span class="params">self, request, context</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Missing associated documentation comment in .proto file.&quot;&quot;&quot;</span></span><br><span class="line">        context.set_code(grpc.StatusCode.UNIMPLEMENTED)</span><br><span class="line">        context.set_details(<span class="string">&#x27;Method not implemented!&#x27;</span>)</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">&#x27;Method not implemented!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_WindServerServicer_to_server</span>(<span class="params">servicer, server</span>):</span><br><span class="line">    rpc_method_handlers = &#123;</span><br><span class="line">            <span class="string">&#x27;wind_predict&#x27;</span>: grpc.unary_unary_rpc_method_handler(</span><br><span class="line">                    servicer.wind_predict,</span><br><span class="line">                    request_deserializer=wind__pb2.Request.FromString,</span><br><span class="line">                    response_serializer=wind__pb2.Response.SerializeToString,</span><br><span class="line">            ),</span><br><span class="line">    &#125;</span><br><span class="line">    generic_handler = grpc.method_handlers_generic_handler(</span><br><span class="line">            <span class="string">&#x27;WindServer&#x27;</span>, rpc_method_handlers)</span><br><span class="line">    server.add_generic_rpc_handlers((generic_handler,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment"># This class is part of an EXPERIMENTAL API.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WindServer</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Missing associated documentation comment in .proto file.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wind_predict</span>(<span class="params">request,</span></span><br><span class="line"><span class="params">            target,</span></span><br><span class="line"><span class="params">            options=(<span class="params"></span>),</span></span><br><span class="line"><span class="params">            channel_credentials=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">            call_credentials=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">            insecure=<span class="literal">False</span>,</span></span><br><span class="line"><span class="params">            compression=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">            wait_for_ready=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">            timeout=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">            metadata=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">return</span> grpc.experimental.unary_unary(request, target, <span class="string">&#x27;/WindServer/wind_predict&#x27;</span>,</span><br><span class="line">            wind__pb2.Request.SerializeToString,</span><br><span class="line">            wind__pb2.Response.FromString,</span><br><span class="line">            options, channel_credentials,</span><br><span class="line">            insecure, call_credentials, compression, wait_for_ready, timeout, metadata)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到pb2_grpc中定义了3个类与1个方法：</p>
<ol>
<li>class *Stub: 为客户端提供了一个桩，绑定到某个远程服务的类上。</li>
<li>class *Servicer: 服务端提供的类，其方法供客户端调用，服务端具体实现需要继承该类。</li>
<li>class *Server: 实验性API，包含了一个静态方法，作用未知~</li>
<li>method add_WindServerServicer_to_server：使用该方法能够将服务端的具体实现绑定到一个gRPC server上。</li>
</ol>
<p>到此，proto buffer与围绕其生成的用于解读报文&#x2F;流的类就解读完了。</p>
<h2 id="编写客户端与服务端"><a href="#编写客户端与服务端" class="headerlink" title="编写客户端与服务端"></a>编写客户端与服务端</h2><h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><p>代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> wind_pb2</span><br><span class="line"><span class="keyword">import</span> wind_pb2_grpc</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> concurrent <span class="keyword">import</span> futures</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WindPredictSrv</span>(wind_pb2_grpc.WindServerServicer):</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wind_predict</span>(<span class="params">self, request, context</span>):</span><br><span class="line">        <span class="built_in">print</span>(request.content)</span><br><span class="line">        <span class="keyword">return</span> wind_pb2.Response(msg=<span class="string">&quot;%s!&quot;</span> % request.content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">server</span>():</span><br><span class="line">    option = [(<span class="string">&#x27;grpc.keepalive_timeout_ms&#x27;</span>, <span class="number">10000</span>)]</span><br><span class="line">    grpc_server = grpc.server(futures.ThreadPoolExecutor(max_workers=<span class="number">10</span>),options=option)</span><br><span class="line">    wind_pb2_grpc.add_WindServerServicer_to_server(WindPredictSrv(),grpc_server)</span><br><span class="line">    grpc_server.add_insecure_port(<span class="string">&quot;[::]:50051&quot;</span>)</span><br><span class="line">    grpc_server.start()</span><br><span class="line">    grpc_server.wait_for_termination()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    server()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在服务端代码中，我们通过WindPredictSrv继承前面生成pb2_grpc.py代码中的WindServerServicer类，并重写了wind_predict方法。</p>
<p>然后，生成一个grpc_server，并通过add_WindServerServicer_to_server将其加入其中，并在所有IP的50051端口监听。</p>
<h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> wind_pb2 <span class="keyword">as</span> wind_pb2</span><br><span class="line"><span class="keyword">import</span> wind_pb2_grpc <span class="keyword">as</span> wind_pb2_grpc</span><br><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="keyword">with</span> grpc.insecure_channel(target = <span class="string">&quot;localhost:50051&quot;</span>) <span class="keyword">as</span> channel:</span><br><span class="line">        stub = wind_pb2_grpc.WindServerStub(channel)</span><br><span class="line">        response = stub.wind_predict(wind_pb2.Request(content=<span class="string">&quot;hellp grpc&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Res:&quot;</span>+response.msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>客户端较为简单，首先打开服务端对应端口的channel，然后使用WindServerStub绑定这个channel，之后就能将stub作为一个WindPredictSrv实例使用了。</p>
<h2 id="一些补充"><a href="#一些补充" class="headerlink" title="一些补充"></a>一些补充</h2><h3 id="What’s-Channel"><a href="#What’s-Channel" class="headerlink" title="What’s Channel"></a>What’s Channel</h3><p>在编写服务端与客户端代码时，我们并未直接指定一个server或stub的地址与端口，而是通过添加一个Channel来实现这件事。</p>
<p>所以，Channel是什么呢？</p>
<p>我们知道，Http1.0是最为经典的客户端与服务端一问一答架构，发出Request，返回Response。</p>
<p>为了避免过多的TCP握手，Http1.1中将Http涉及的TCP连接改成了长连接。但是，客户端还是需要等服务端返回上一条Request的Response才能发出下一条Request。</p>
<p>最后，在Http2中，实现了流式传输，通讯双方可以连续发送报文。</p>
<p>Channel正是gRpc中对这种长的流式连接的一种抽象，将提供具体调用的Server与管理连接的Channel分离，保持业务的纯正性，其间可以形成多对多联系，即多个Server共用一个Channel，或一个Server注册于多个Channel。</p>
<p>实现了软件工程的关注点分离原则，利好开发。</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%EF%BC%9A%E8%87%AA%E7%BC%96%E7%A0%81%E5%99%A8/" rel="prev" title="深度学习：自编码器">
                  <i class="fa fa-chevron-left"></i> 深度学习：自编码器
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="next" title="响应式编程">
                  响应式编程 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Logres</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":225,"height":450},"mobile":{"show":true},"log":false});</script></body>
</html>
